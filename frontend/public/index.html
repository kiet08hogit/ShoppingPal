<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/images/industra-logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap'">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.5.0/semantic.min.css" integrity="sha512-KXol4x3sVoO+8ZsWPFI/r5KBVB/ssCGB5tsv2nVOKwLg33wTFP3fmnXa47FdSVIshVTgsYk/1734xSk9aFIa4A==" crossorigin="anonymous" referrerpolicy="no-referrer"Â />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>INDUSTRA</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <div id="agentContainer">
      <div id="webchatContainer">
        <iframe 
          src="https://copilotstudio.microsoft.com/environments/Default-e202cd47-7a56-4baa-99e3-e3b71a7c77dd/bots/copilots_header_9ffd6/webchat?__version__=2"
          class="copilot-iframe"
          title="Industra Assistant">
        </iframe>

        <div id="webchat"></div>
      </div>
      <button id="agentButton" onclick="toggleAgent()">Ask me!</button>
    </div>

    <script>
      let chatLoaded = false;
      async function loadWebChat(){
        WebChat.renderWebChat(
          { directLine, styleOptions },
          document.getElementById("webchat")
        );

        const subscription = directLine.connectionStatus$.subscribe({
          next(value) {
            if (value === 2) {
              directLine
              .postActivity({
                type: "event",
                name: "startConversation",
                locale: document.documentElement.lang || "en",
                from: { id: "user" },
              })
              .subscribe();
              subscription.unsubscribe();
            }
          },
        });
        chatLoaded = true;
      }
      async function toggleAgent() {
        const chatContainer = document.getElementById("webchatContainer");
          const button = document.getElementById("agentButton");
          if (!chatContainer.classList.contains("active")) {
          //Open chat
          chatContainer.classList.add("active");
          button.textContent = "Close";
          if (!chatLoaded) await loadWebChat();
          //focus input
          const observer = new MutationObserver((mutations, obs) => {
          const textInput = document.querySelector(".webchat__send-box-text-box__input");
          if (textInput) {
            textInput.focus();
            obs.disconnect();
            }
        });
          
        observer.observe(document.getElementById("webchat"), {
            childList: true,
            subtree: true,
        });
      } else {
        //close chat
        chatContainer.classList.remove("active");
        button.textContent = "Ask me!";
      }
    }
    </script>
  </body>
</html>
<script src="	https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>